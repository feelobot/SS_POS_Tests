require 'rubygems'
require 'bundler/setup'	
require 'capybara/cucumber'
require 'timeout'
require 'selenium-webdriver'
require 'watir-webdriver'
#///////////////////////////////////////////////////////////////////////////////////////////////////
# ADDED CUSTOM LIB
#///////////////////////////////////////////////////////////////////////////////////////////////////
require 'cucumber/formatter/unicode'
$:.unshift(File.dirname(__FILE__) + '/../../lib')
require 'load'
#///////////////////////////////////////////////////////////////////////////////////////////////////

#///////////////////////////////////////////////////////////////////////////////////////////////////
# REQUIREMENTS FOR HEADLESS MODE (NO VISIBLE BROWSER)
#///////////////////////////////////////////////////////////////////////////////////////////////////
if ENV['HEADLESS']
  require 'headless'
  headless = Headless.new
  headless.start 
  headless.video.start_capture
 
  at_exit do
  	headless.video.stop_and_save("sspos_cukes#{Time.now}.mov")
    headless.destroy
  end
end
#///////////////////////////////////////////////////////////////////////////////////////////////////
# WATIR START AND CONFIG 
#///////////////////////////////////////////////////////////////////////////////////////////////////
$b = Watir::Browser.new :chrome
$baseURL= "http://rogerspos:be81f6@173.242.122.14/"
$ss = Load.new	

#///////////////////////////////////////////////////////////////////////////////////////////////////
# DATABASE SNAPSHOT CONTROL
#///////////////////////////////////////////////////////////////////////////////////////////////////

After do |scenario|
	if ENV['SNAPSHOTS']
		if(scenario.failed?)
			puts "scenario failed no snapshot taken"
		else
			$b.goto($baseURL + "exportDB.php?name=#{scenario.feature.name}")
			$b.p(:text, /Completed/).wait_until_present
			puts "#{scenario.feature.name} DB Created"
		end
	end
	Cucumber.wants_to_quit = true if scenario.failed?
end	
#///////////////////////////////////////////////////////////////////////////////////////////////////



